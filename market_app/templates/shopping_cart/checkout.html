{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}
<style>
    #checkoutMethods {
        background: #fff;
        border-radius: 2px;
        display: inline-block;
        max-height: 700px;
        margin: 1rem;
        position: relative;
        width: 700px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
    }

    body {
        /* padding-top: 70px; */
        font-family: Poppins;
    }
</style>





<body>
    <div class="all-title-box" style="background-color:#b0b435">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h2>Checkout</h2>
                </div>
            </div>
        </div>
    </div> <br><br>
    <div class="container">
        <section>
            <div class="row" id="tablerow">
                <div class="col-md-5 col-xs-12">
                    <div class="panel panel-primary">
                        <div class="panel-body">
                            <h5 style="font-size: 24px;font-weight: 700;text-transform: uppercase;">Deliver
                                Address<br><small></small></h5>
                            <div>
                                <!-- <form action="" method="post" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    {{ form|crispy }}
                                   
                                </form> -->
                                <button type="submit" onClick="makePayment()" class="btn btn-warning btn-lg btn-block"
                                    style="background-color: #b0b435;border:none;">checkout</button>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="col-md-1 col-xs-12"></div>
                <div class="col-md-6 col-xs-12">
                    <br>
                    <h5 style="font-size: 24px;font-weight: 700;text-transform: uppercase;">Your Order Summary</h5>
                    <table class="table">
                        <tr>
                            <td>
                                {% for item in order%}
                        <tr>
                            <td>{{ item.items.grocery.name }}</td>
                            <td>rwf {{ item.items.grocery.price }}</td>
                            <td>kgs {{ item.items.quantity }}</td>
                            <td>rwf {{ item.sub_total_amount }}</td>
                        </tr>
                        {% endfor %}
                        </td>
                        </tr>
                        <tr>
                            <td><strong>Order Total</strong> </td>
                            <td> <strong>rwf {{ total_amount }}</strong></td>

                        </tr>
                    </table>
                </div>
            </div>
            </div>
        </section>
 
        <div class="footer-copyright">
            <p class="footer-company">All Rights Reserved. &copy; 2021 <a href="#">NYARUGENGE MARKET</a> </p>
        </div>
        
        <a href="#" id="back-to-top" title="Back to top" style="display: none;">&uarr;</a>




        
        <script>
            const makePayment = () => {
                var headers = new Headers();
                const url = 'https://api.flutterwave.com/v3/payments';
                headers.append("Access-Control-Allow-Origin", "*")
                headers.append('Content-Type', 'application/json');
                headers.append('Accept', 'application/json');
                headers.append('Authorization', `Bearer FLWSECK_TEST-05f0494d5fe92f48a8dc76b9902dd92c-X`);
                headers.append("Access-Control-Allow-Headers", "Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With")
                const pay = {
                    "tx_ref": "JJEEJEMMED",
                    "amount": "6600",
                    "currency": "RWF",
                    "redirect_url": "https://www.google.com",
                    "payment_options": "card",
        
                    "customer": {
                        "email": "rithamarie9@gmail.com",
                        "phonenumber": "0783879009",
                        "name": "umutoni ritha"
                    },
                    "customizations": {
                        "title": "groceries",
                        "description": "fresh fruits",
                        "logo": "https://res.cloudinary.com/auca/image/upload/v1614703067/logo_cmkggu.png"
                    }
                }
                fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(pay),
                }).then(async (response) => {
                    const { data } = response
                    return (window.location = await data.link);
                }).catch(err => {
                    console.log(err)
                });
        
            }
        </script>
        {% endblock %}
